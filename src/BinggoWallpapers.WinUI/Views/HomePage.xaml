<Page
    x:Class="BinggoWallpapers.WinUI.Views.HomePage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:animations="using:CommunityToolkit.WinUI.Animations"
    xmlns:behaviors="using:CommunityToolkit.WinUI.Behaviors"
    xmlns:controls="using:CommunityToolkit.WinUI.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:dto="using:BinggoWallpapers.Core.DTOs"
    xmlns:ex="using:ImageEx"
    xmlns:i="using:Microsoft.Xaml.Interactivity"
    xmlns:labs="using:CommunityToolkit.Labs.WinUI"
    xmlns:local="using:BinggoWallpapers.WinUI.Views"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:media="using:CommunityToolkit.WinUI.Media"
    xmlns:model="using:BinggoWallpapers.WinUI.Models"
    xmlns:uc="using:BinggoWallpapers.WinUI.UserControls"
    xmlns:ui="using:CommunityToolkit.WinUI"
    ui:FrameworkElementExtensions.EnableActualSizeBinding="True"
    mc:Ignorable="d">

    <i:Interaction.Behaviors>
        <i:EventTriggerBehavior EventName="Loaded">
            <i:InvokeCommandAction Command="{x:Bind ViewModel.LoadedCommand}" />
        </i:EventTriggerBehavior>
    </i:Interaction.Behaviors>

    <!--  主要内容区域  -->
    <Grid>
        <GridView
            x:Name="GalleryView"
            Margin="-12,0,-24,0"
            Padding="12"
            animations:Implicit.HideAnimations="{StaticResource HideTransitions}"
            animations:Implicit.ShowAnimations="{StaticResource ShowTransitions}"
            animations:ItemsReorderAnimation.Duration="0:0:0.2"
            ui:ListViewExtensions.Command="{x:Bind ViewModel.WallpaperSelectedCommand}"
            ui:ListViewExtensions.ItemContainerStretchDirection="Both"
            IncrementalLoadingThreshold="6"
            IncrementalLoadingTrigger="Edge"
            IsItemClickEnabled="True"
            ItemContainerStyle="{StaticResource CustomGridViewItemStyle}"
            ItemsSource="{x:Bind ViewModel.Wallpapers, Mode=OneWay}"
            ScrollViewer.HorizontalScrollBarVisibility="Disabled"
            ScrollViewer.HorizontalScrollMode="Disabled"
            ScrollViewer.IsDeferredScrollingEnabled="False"
            ScrollViewer.VerticalScrollBarVisibility="Auto"
            ScrollViewer.VerticalScrollMode="Enabled"
            ScrollViewer.ZoomMode="Disabled"
            SelectedItem="{x:Bind ViewModel.SelectedWallpaper, Mode=OneWay}"
            SelectionMode="None">
            <GridView.ItemContainerTransitions>
                <TransitionCollection>
                    <EntranceThemeTransition FromVerticalOffset="20" IsStaggeringEnabled="True" />
                </TransitionCollection>
            </GridView.ItemContainerTransitions>
            <GridView.ItemTemplate>
                <DataTemplate x:DataType="dto:WallpaperInfoDto">
                    <uc:CustomCard Model="{x:Bind}" />
                </DataTemplate>
            </GridView.ItemTemplate>
            <GridView.Header>
                <uc:CustomHeader
                    Title="{x:Bind ViewModel.Today.Title, Mode=OneWay}"
                    Margin="0,0,0,12"
                    Desc="{x:Bind ViewModel.Today.Caption, Mode=OneWay}"
                    ItemsSource="{x:Bind ViewModel.Markets, Mode=OneWay}"
                    SelectedItem="{x:Bind ViewModel.SelectedMarket, Mode=TwoWay}"
                    Source="{x:Bind ViewModel.Today.Url, Mode=OneWay}"
                    Subtitle="{x:Bind ViewModel.Today.Fullstartdate, Mode=OneWay, Converter={StaticResource StringFormatConverter}, ConverterParameter={}{0:yyyy-MM-dd}}">
                    <i:Interaction.Behaviors>
                        <behaviors:FadeHeaderBehavior />
                    </i:Interaction.Behaviors>
                </uc:CustomHeader>
            </GridView.Header>
            <GridView.Footer>
                <uc:CustomFooter
                    Margin="0"
                    IsEmpty="{x:Bind local:HomePage.IsEmpty(ViewModel.Wallpapers), Mode=OneWay}"
                    IsLoading="{x:Bind ViewModel.IsLoading, Mode=OneWay}" />
            </GridView.Footer>
        </GridView>
        <uc:BackToTop
            Margin="0,0,32,32"
            HorizontalAlignment="Right"
            VerticalAlignment="Bottom"
            AutoHiding="True"
            Target="{Binding ElementName=GalleryView}" />
    </Grid>
</Page>
