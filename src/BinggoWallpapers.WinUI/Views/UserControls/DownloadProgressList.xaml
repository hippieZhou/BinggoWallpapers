<?xml version="1.0" encoding="utf-8" ?>
<UserControl
    x:Class="BinggoWallpapers.WinUI.Views.UserControls.DownloadProgressList"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="using:CommunityToolkit.WinUI.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:i="using:Microsoft.Xaml.Interactivity"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:model="using:BinggoWallpapers.WinUI.Models"
    xmlns:ui="using:CommunityToolkit.WinUI"
    mc:Ignorable="d">
    <i:Interaction.Behaviors>
        <i:EventTriggerBehavior EventName="Loaded">
            <i:InvokeCommandAction Command="{x:Bind ViewModel.LoadedCommand}" />
        </i:EventTriggerBehavior>
    </i:Interaction.Behaviors>

    <Grid RowSpacing="8">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>
        <TextBlock
            x:Uid="DownloadProgressList_Title"
            d:Text="Downloads"
            FontWeight="SemiBold"
            Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
        <Button
            HorizontalAlignment="Right"
            Content="{ui:FontIcon Glyph=&#xE712;,
                                  FontSize=16}"
            Style="{StaticResource SubtleButtonStyle}"
            ToolTipService.ToolTip="More options">
            <Button.Flyout>
                <MenuFlyout>
                    <MenuFlyoutItem
                        x:Uid="DownloadProgressList_Clear"
                        d:Text="Clear history"
                        Command="{x:Bind ViewModel.ClearDownloadQueueCommand}" />
                </MenuFlyout>
            </Button.Flyout>
        </Button>
        <ItemsRepeater
            Grid.Row="1"
            IsTabStop="False"
            ItemsSource="{x:Bind ViewModel.Downloads}">
            <ItemsRepeater.Layout>
                <StackLayout Spacing="8" />
            </ItemsRepeater.Layout>
            <ItemsRepeater.ItemTemplate>
                <DataTemplate x:DataType="model:DownloadableModel">
                    <controls:SettingsCard
                        MinHeight="48"
                        Padding="12,8,12,8"
                        AutomationProperties.Name="{x:Bind ModelDetails.Caption}"
                        CornerRadius="{StaticResource OverlayCornerRadius}">
                        <controls:SettingsCard.Resources>
                            <Thickness x:Key="SettingsCardHeaderIconMargin">2,0,12,0</Thickness>
                            <x:Double x:Key="SettingsCardWrapThreshold">286</x:Double>
                            <x:Double x:Key="SettingsCardContentMinWidth">0</x:Double>
                        </controls:SettingsCard.Resources>
                        <controls:SettingsCard.Header>
                            <Grid ColumnSpacing="4">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <TextBlock
                                    MaxWidth="286"
                                    VerticalAlignment="Center"
                                    Text="{x:Bind ModelDetails.Title}"
                                    TextTrimming="CharacterEllipsis" />
                                <Button
                                    Grid.Column="1"
                                    Padding="2"
                                    Content="{x:Bind ResolutionName}"
                                    Style="{StaticResource TertiaryButtonStyle}" />
                            </Grid>
                        </controls:SettingsCard.Header>
                        <controls:SettingsCard.HeaderIcon>
                            <ImageIcon AutomationProperties.AccessibilityView="Raw" Source="{x:Bind ModelDetails.Url}" />
                        </controls:SettingsCard.HeaderIcon>
                        <controls:SettingsCard.Description>
                            <Grid ColumnSpacing="8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>
                                <ProgressBar
                                    Height="4"
                                    Margin="0,2,0,2"
                                    IsIndeterminate="False"
                                    Visibility="{x:Bind DownloadStatusProgressVisibility(Status)}"
                                    Value="{x:Bind Progress}" />
                                <TextBlock
                                    Grid.Column="1"
                                    MinWidth="36"
                                    HorizontalAlignment="Right"
                                    VerticalAlignment="Center"
                                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                    Text="{x:Bind TotalBytes, Converter={StaticResource FormattedFileSizeConverter}}"
                                    Visibility="{x:Bind DownloadStatusProgressVisibility(Status)}" />
                                <TextBlock
                                    Grid.Row="1"
                                    Grid.ColumnSpan="2"
                                    FontSize="10">
                                    <Run Text="{x:Bind TotalBytes, Converter={StaticResource FormattedFileSizeConverter}}" />
                                    <Run Text="-" />
                                    <Run Text="{x:Bind StatusToText(Status)}" />
                                </TextBlock>
                            </Grid>
                        </controls:SettingsCard.Description>
                        <Grid>
                            <Button
                                Grid.RowSpan="3"
                                Grid.Column="2"
                                Width="32"
                                Height="32"
                                Padding="0"
                                VerticalAlignment="Center"
                                Command="{x:Bind OpenCommand}"
                                Content="{ui:FontIcon Glyph=&#xE838;,
                                                      FontSize=14}"
                                Style="{StaticResource SubtleButtonStyle}"
                                ToolTipService.ToolTip="View image"
                                Visibility="{x:Bind VisibleWhenDownloaded(Status), Mode=OneWay}" />
                            <Button
                                Grid.RowSpan="3"
                                Grid.Column="2"
                                Width="32"
                                Height="32"
                                Padding="0"
                                VerticalAlignment="Center"
                                AutomationProperties.Name="Retry"
                                Command="{x:Bind RetryCommand}"
                                Content="{ui:FontIcon Glyph=&#xE72C;,
                                                      FontSize=14}"
                                Style="{StaticResource SubtleButtonStyle}"
                                ToolTipService.ToolTip="Retry"
                                Visibility="{x:Bind VisibleWhenCanceled(Status), Mode=OneWay}" />
                            <Button
                                Grid.RowSpan="3"
                                Grid.Column="2"
                                Width="32"
                                Height="32"
                                Padding="0"
                                VerticalAlignment="Center"
                                AutomationProperties.Name="Cancel"
                                Command="{x:Bind CancelCommand}"
                                Content="{ui:FontIcon Glyph=&#xE711;,
                                                      FontSize=14}"
                                Style="{StaticResource SubtleButtonStyle}"
                                ToolTipService.ToolTip="Cancel"
                                Visibility="{x:Bind VisibleWhenDownloading(Status)}" />
                            <Button
                                Grid.RowSpan="3"
                                Grid.Column="2"
                                Width="32"
                                Height="32"
                                Padding="0"
                                VerticalAlignment="Center"
                                AutomationProperties.Name="Download failed - click to retry"
                                Command="{x:Bind RetryCommand}"
                                Style="{StaticResource SubtleButtonStyle}"
                                ToolTipService.ToolTip="{x:Bind ErrorMessage}"
                                Visibility="{x:Bind VisibleWhenFailed(Status)}">
                                <FontIcon
                                    FontSize="14"
                                    Foreground="{ThemeResource SystemFillColorCautionBrush}"
                                    Glyph="&#xE72C;" />
                            </Button>
                        </Grid>
                    </controls:SettingsCard>
                </DataTemplate>
            </ItemsRepeater.ItemTemplate>
        </ItemsRepeater>
    </Grid>
</UserControl>
